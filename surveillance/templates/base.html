{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <title>{% block title %}{% endblock %}</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <link href="{% static "/css/base.css" %}" rel="stylesheet">
        <link rel="icon" href="{% static 'favicon.ico' %}">
    </head>
    
    <body>
        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <h2
            > <a href="{% url "index" %}"><span class="logo">ORION'S SHIELD</span></a> </h2>
            {% if request.user.is_authenticated %}
                <ul class="menu">
                    <li {% if section == "dashboard" %}class="selected"{% endif %}>
                        <a href="{% url "dashboard" %}">My dashboard</a>
                    </li>
                    <li {% if section == "cameras" %}class="selected"{% endif %}>
                        <a href="{% url "cameras" %}">Camera Feeds</a>
                    </li>
                    <li {% if section == "Upload" %}class="selected"{% endif %}>
                        <a href="{% url "upload" %}"> Details Upload </a>
                    </li>
                    <li {% if section == "Notifications" %}class="selected"{% endif %}>
                        <a href="{% url "Notifications" %}"> Notifications <span class="badge">{{ count }}</span></a>
                    </li>
                    <li {% if section == "edit" %}class="selected"{% endif %}>
                        <a href="{% url "edit" %}">My Settings</a>
                    </li>
                    <li {% if section == "logout" %}class="selected"{% endif %}>
                        <a href="{% url "logged_out" %}">Log Out</a>
                    </li>
                </ul>

            {% else %}
                <a href="{% url "login" %}">Log-in</a>
            {% endif %}
        </div>

        <div id="main">
            <span class="open-nav" onclick="openNav()">&#9776;</span>
            
            <div class="user-container">
                {% if request.user.is_authenticated %}
                    {% if messages %}
                        <ul class="messages">
                            {% for message in messages %}
                                <li class="{{ message.tags }}">
                                    {{ message|safe }}
                                    <a href="/" class="close">x</a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endif %}
            </div>
            
            <div id="content">
                {% block content %}
                {% endblock %}
            </div>
        </div>

        <script>
            function openNav() {
                document.getElementById("mySidenav").style.width = "250px";
                document.getElementById("main").style.marginLeft = "250px";
            }

            function closeNav() {
                document.getElementById("mySidenav").style.width = "0";
                document.getElementById("main").style.marginLeft = "0";
            }

            // Close message notifications when x is clicked
            document.addEventListener('DOMContentLoaded', function() {
                const closeButtons = document.querySelectorAll('.messages .close');
                closeButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        this.parentElement.style.display = 'none';
                    });
                });
            });
            
            importScripts('https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js');
            importScripts('https://www.gstatic.com/firebasejs/10.0.0/firebase-messaging-compat.js');

            firebase.initializeApp({
            apiKey: "YOUR-API-KEY",
            authDomain: "YOUR-PROJECT.firebaseapp.com",
            projectId: "YOUR-PROJECT-ID",
            messagingSenderId: "YOUR-SENDER-ID",
            appId: "YOUR-APP-ID"
            });

            const messaging = firebase.messaging();

            messaging.onBackgroundMessage(function(payload) {
                console.log('[firebase-messaging-sw.js] Received background message ', payload);
                // Customize notification
                self.registration.showNotification(payload.notification.title, {
                    body: payload.notification.body,
                    icon: '/icon.png'
                });
            });

        </script>
    </body>
</html>


